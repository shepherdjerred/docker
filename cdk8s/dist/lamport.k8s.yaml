apiVersion: v1
kind: Namespace
metadata:
  name: glitter-boys-beta
  namespace: lamport
---
apiVersion: v1
kind: Namespace
metadata:
  name: glitter-boys-prod
  namespace: lamport
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-esphome
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-esphome-c87859eb
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-esphome-c87859eb
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
          image: esphome/esphome
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 6052
              name: port-6052-web
              protocol: TCP
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsGroup: 0
            runAsNonRoot: false
            runAsUser: 0
          volumeMounts:
            - mountPath: /config
              name: pvc-esphome-pvc
      dnsPolicy: ClusterFirst
      hostNetwork: true
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-esphome-pvc
          persistentVolumeClaim:
            claimName: esphome-pvc
            readOnly: false
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: esphome-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-esphome-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 6052
  selector:
    cdk8s.io/metadata.addr: lamport-esphome-c87859eb
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    tailscale.com/funnel: "true"
  name: lamport-esphome-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-esphome-service
      port:
        number: 6052
  ingressClassName: tailscale
  tls:
    - hosts:
        - esphome
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-bazarr
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-bazarr-c8584962
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-bazarr-c8584962
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: ""
            - name: PUID
              value: "1000"
            - name: PGID
              value: "1000"
          image: lscr.io/linuxserver/bazarr
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 6767
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsGroup: 0
            runAsNonRoot: false
            runAsUser: 0
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 6767
          volumeMounts:
            - mountPath: /config
              name: pvc-bazarr-pvc
            - mountPath: /movies
              name: bazarr-movies-bind-mount
            - mountPath: /tv
              name: bazarr-tv-bind-mount
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-bazarr-pvc
          persistentVolumeClaim:
            claimName: bazarr-pvc
            readOnly: false
        - hostPath:
            path: /mnt/storage/media/movies
            type: ""
          name: bazarr-movies-bind-mount
        - hostPath:
            path: /mnt/storage/media/tv
            type: ""
          name: bazarr-tv-bind-mount
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: bazarr-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-bazarr-service
  namespace: lamport
spec:
  externalIPs: []
  ipFamilyPolicy: RequireDualStack
  ports:
    - port: 6767
  selector:
    cdk8s.io/metadata.addr: lamport-bazarr-c8584962
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lamport-bazarr-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-bazarr-service
      port:
        number: 6767
  ingressClassName: tailscale
  tls:
    - hosts:
        - bazarr
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-tautulli
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-tautulli-c827b506
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-tautulli-c827b506
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: PUID
              value: "1000"
            - name: PGID
              value: "1000"
          image: lscr.io/linuxserver/tautulli
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 8181
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsGroup: 0
            runAsNonRoot: false
            runAsUser: 0
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 8181
          volumeMounts:
            - mountPath: /config
              name: pvc-tautulli-pvc
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-tautulli-pvc
          persistentVolumeClaim:
            claimName: tautulli-pvc
            readOnly: false
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: tautulli-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-tautulli-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 8181
  selector:
    cdk8s.io/metadata.addr: lamport-tautulli-c827b506
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lamport-tautulli-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-tautulli-service
      port:
        number: 8181
  ingressClassName: tailscale
  tls:
    - hosts:
        - tautulli
---
apiVersion: onepassword.com/v1
kind: OnePasswordItem
metadata:
  name: invidious-postgres-onepassword
  namespace: lamport
spec:
  itemPath: vaults/v64ocnykdqju4ui6j6pua56xw4/items/l7quccusjzdh4ww5rhutqpaf2m
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-invidious-postgres-deployment
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-invidious-postgres-deployment-c8d65c94
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-invidious-postgres-deployment-c8d65c94
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: password
                  name: invidious-postgres-onepassword
            - name: PGDATA
              value: /var/lib/postgresql/data/pgdata
            - name: POSTGRES_DB
              value: invidious
          image: postgres
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 5432
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsGroup: 1000
            runAsNonRoot: true
            runAsUser: 1000
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 5432
          volumeMounts:
            - mountPath: /var/lib/postgresql/data
              name: pvc-invidious-postgres-volume
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-invidious-postgres-volume
          persistentVolumeClaim:
            claimName: invidious-postgres-volume
            readOnly: false
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-invidious-postgres-deployment-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 5432
      targetPort: 5432
  selector:
    cdk8s.io/metadata.addr: lamport-invidious-postgres-deployment-c8d65c94
  type: ClusterIP
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: invidious-postgres-volume
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-invidious
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-invidious-c896b883
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-invidious-c896b883
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
          image: quay.io/invidious/invidious
          imagePullPolicy: Always
          name: invidious
          ports:
            - containerPort: 3000
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: true
            runAsGroup: 1000
            runAsNonRoot: true
            runAsUser: 1000
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 3000
          volumeMounts:
            - mountPath: /invidious/config/config.yml
              name: configmap-lamport-invidious-conf
              subPath: config.yml
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - configMap:
            items:
              - key: config.yml
                path: config.yml
            name: lamport-invidious-conf
          name: configmap-lamport-invidious-conf
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: lamport-invidious-conf
  namespace: lamport
data:
  config.yml: |
    db:
      dbname: invidious
      user: postgres
      # not exposed to outside of the cluster, so this should be OK
      # ideally this should be a secret
      password: "orJ.U8QskAB3szvUK-8*"
      host: "lamport-invidious-postgres-deployment-service"
      port: 5432
    check_tables: true
    hmac_key: "f.3_RvweD9yDyxnfvgfA"
immutable: false
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-invidious-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 3000
  selector:
    cdk8s.io/metadata.addr: lamport-invidious-c896b883
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lamport-invidious-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-invidious-service
      port:
        number: 3000
  ingressClassName: tailscale
  tls:
    - hosts:
        - invidious
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-teddis-redis-deployment
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-teddis-redis-deployment-c853563b
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-teddis-redis-deployment-c853563b
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
          image: redis
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 6379
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: true
            runAsGroup: 999
            runAsNonRoot: true
            runAsUser: 999
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 6379
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-teddis-redis-deployment-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 6379
      targetPort: 6379
  selector:
    cdk8s.io/metadata.addr: lamport-teddis-redis-deployment-c853563b
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-teddit
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-teddit-c82b0ffa
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-teddit-c82b0ffa
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: REDIS_HOST
              value: lamport-teddis-redis-deployment-service
            - name: DOMAIN
              value: teddit.tailnet-1a49.ts.net
          image: teddit/teddit
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 8080
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsNonRoot: true
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 8080
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsGroup: 1000
        runAsNonRoot: true
        runAsUser: 1000
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-teddit-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 8080
  selector:
    cdk8s.io/metadata.addr: lamport-teddit-c82b0ffa
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lamport-teddit-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-teddit-service
      port:
        number: 8080
  ingressClassName: tailscale
  tls:
    - hosts:
        - teddit
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-plex
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-plex-c853a5e2
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-plex-c853a5e2
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: ADVERTISE_IP
              value: https://plex.tailnet-1a49.ts.net
          image: plexinc/pms-docker
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 32400
              hostIP: 0.0.0.0
              hostPort: 32400
              name: port-32400-web
              protocol: TCP
            - containerPort: 1900
              hostPort: 1900
              name: port-1900-dlna
              protocol: UDP
            - containerPort: 5353
              hostPort: 5353
              name: port-5353
              protocol: UDP
            - containerPort: 3005
              hostPort: 3005
              name: port-3005
              protocol: TCP
            - containerPort: 8324
              hostPort: 8324
              name: port-8324-roku
              protocol: TCP
            - containerPort: 32469
              hostPort: 32469
              name: port-32469-dlna
              protocol: TCP
            - containerPort: 32410
              hostPort: 32410
              name: port-32410-gdm
              protocol: UDP
            - containerPort: 32412
              hostPort: 32412
              name: port-32412-gdm
              protocol: UDP
            - containerPort: 32413
              hostPort: 32413
              name: port-32413-gdm
              protocol: UDP
            - containerPort: 32414
              hostPort: 32414
              name: port-32414-gdm
              protocol: UDP
          resources:
            limits:
              gpu.intel.com/i915: 1
          securityContext:
            allowPrivilegeEscalation: true
            privileged: true
            readOnlyRootFilesystem: false
            runAsNonRoot: false
          volumeMounts:
            - mountPath: /config
              name: pvc-plex-pvc
            - mountPath: /data/tv
              name: plex-tv-bind-mount
            - mountPath: /data/movies
              name: plex-movies-bind-mount
            - mountPath: /data/other
              name: plex-other-bind-mount
            - mountPath: /data/music
              name: plex-music-bind-mount
            - mountPath: /transcode
              name: plex-shm-mount
            - mountPath: /dev/dvb
              name: plex-dev-dvb-bind-mount
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-plex-pvc
          persistentVolumeClaim:
            claimName: plex-pvc
            readOnly: false
        - hostPath:
            path: /mnt/storage/media/tv
            type: ""
          name: plex-tv-bind-mount
        - hostPath:
            path: /mnt/storage/media/movies
            type: ""
          name: plex-movies-bind-mount
        - hostPath:
            path: /mnt/storage/media/other
            type: ""
          name: plex-other-bind-mount
        - hostPath:
            path: /mnt/storage/media/music
            type: ""
          name: plex-music-bind-mount
        - emptyDir:
            medium: Memory
            sizeLimit: 8192Mi
          name: plex-shm-mount
        - hostPath:
            path: /dev/dvb
            type: ""
          name: plex-dev-dvb-bind-mount
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: plex-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-plex-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 32400
  selector:
    cdk8s.io/metadata.addr: lamport-plex-c853a5e2
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    tailscale.com/funnel: "true"
  name: lamport-plex-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-plex-service
      port:
        number: 32400
  ingressClassName: tailscale
  tls:
    - hosts:
        - plex
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-radarr
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-radarr-c88a1752
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-radarr-c88a1752
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: PUID
              value: "1000"
            - name: PGID
              value: "1000"
          image: lscr.io/linuxserver/radarr
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 7878
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsGroup: 0
            runAsNonRoot: false
            runAsUser: 0
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 7878
          volumeMounts:
            - mountPath: /config
              name: pvc-radarr-pvc
            - mountPath: /downloads
              name: radarr-torrents-bind-mount
            - mountPath: /movies
              name: radarr-movies-bind-mount
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-radarr-pvc
          persistentVolumeClaim:
            claimName: radarr-pvc
            readOnly: false
        - hostPath:
            path: /mnt/storage/downloads/torrents
            type: ""
          name: radarr-torrents-bind-mount
        - hostPath:
            path: /mnt/storage/media/movies
            type: ""
          name: radarr-movies-bind-mount
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: radarr-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-radarr-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 7878
  selector:
    cdk8s.io/metadata.addr: lamport-radarr-c88a1752
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lamport-radarr-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-radarr-service
      port:
        number: 7878
  ingressClassName: tailscale
  tls:
    - hosts:
        - radarr
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-homeassistant
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-homeassistant-c8e21976
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-homeassistant-c8e21976
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
          image: ghcr.io/home-assistant/home-assistant:stable
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 8123
              name: port-8123-web
              protocol: TCP
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsGroup: 0
            runAsNonRoot: false
            runAsUser: 0
          volumeMounts:
            - mountPath: /config
              name: pvc-homeassistant-pvc
      dnsPolicy: ClusterFirst
      hostNetwork: true
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-homeassistant-pvc
          persistentVolumeClaim:
            claimName: homeassistant-pvc
            readOnly: false
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: homeassistant-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-homeassistant-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 8123
  selector:
    cdk8s.io/metadata.addr: lamport-homeassistant-c8e21976
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    tailscale.com/funnel: "true"
  name: lamport-homeassistant-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-homeassistant-service
      port:
        number: 8123
  ingressClassName: tailscale
  tls:
    - hosts:
        - homeassistant
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-nitter-redis-deployment
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-nitter-redis-deployment-c80fc429
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-nitter-redis-deployment-c80fc429
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
          image: redis
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 6379
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: true
            runAsGroup: 999
            runAsNonRoot: true
            runAsUser: 999
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 6379
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-nitter-redis-deployment-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 6379
      targetPort: 6379
  selector:
    cdk8s.io/metadata.addr: lamport-nitter-redis-deployment-c80fc429
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-nitter
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-nitter-c8fb0a68
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-nitter-c8fb0a68
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
          image: zedeus/nitter
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 8080
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: true
            runAsNonRoot: true
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 8080
          volumeMounts:
            - mountPath: /src/nitter.conf
              name: configmap-lamport-nitter-conf
              subPath: nitter.conf
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsGroup: 999
        runAsNonRoot: true
        runAsUser: 999
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - configMap:
            items:
              - key: nitter.conf
                path: nitter.conf
            name: lamport-nitter-conf
          name: configmap-lamport-nitter-conf
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: lamport-nitter-conf
  namespace: lamport
data:
  nitter.conf: |
    [Server]
    address = "0.0.0.0"
    port = 8080
    https = false  # disable to enable cookies when not using https
    httpMaxConnections = 100
    staticDir = "./public"
    title = "nitter"
    hostname = "nitter.tailnet-1a49.ts.net"

    [Cache]
    listMinutes = 240  # how long to cache list info (not the tweets, so keep it high)
    rssMinutes = 10  # how long to cache rss queries
    redisHost = "lamport-nitter-redis-deployment-service"  # Change to "nitter-redis" if using docker-compose
    redisPort = 6379
    redisPassword = ""
    redisConnections = 20  # connection pool size
    redisMaxConnections = 30
    # max, new connections are opened when none are available, but if the pool size
    # goes above this, they're closed when released. don't worry about this unless
    # you receive tons of requests per second

    [Config]
    hmacKey = "vwr5hpc.ATE-puw-tuw"  # random key for cryptographic signing of video urls
    base64Media = false  # use base64 encoding for proxied media urls
    enableRSS = true  # set this to false to disable RSS feeds
    enableDebug = false  # enable request logs and debug endpoints
    proxy = ""  # http/https url, SOCKS proxies are not supported
    proxyAuth = ""
    tokenCount = 10
    # minimum amount of usable tokens. tokens are used to authorize API requests,
    # but they expire after ~1 hour, and have a limit of 187 requests.
    # the limit gets reset every 15 minutes, and the pool is filled up so there's
    # always at least $tokenCount usable tokens. again, only increase this if
    # you receive major bursts all the time

    # Change default preferences here, see src/prefs_impl.nim for a complete list
    [Preferences]
    theme = "Nitter"
    replaceTwitter = "go/nitter"
    replaceYouTube = ""
    replaceReddit = "go/teddit"
    replaceInstagram = ""
    proxyVideos = true
    hlsPlayback = false
    infiniteScroll = false
immutable: false
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-nitter-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 8080
  selector:
    cdk8s.io/metadata.addr: lamport-nitter-c8fb0a68
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lamport-nitter-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-nitter-service
      port:
        number: 8080
  ingressClassName: tailscale
  tls:
    - hosts:
        - nitter
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-overseerr
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-overseerr-c87596e1
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-overseerr-c87596e1
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: PUID
              value: "1000"
            - name: PGID
              value: "1000"
          image: lscr.io/linuxserver/overseerr
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 5055
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsGroup: 0
            runAsNonRoot: false
            runAsUser: 0
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 5055
          volumeMounts:
            - mountPath: /config
              name: pvc-overseerr-pvc
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-overseerr-pvc
          persistentVolumeClaim:
            claimName: overseerr-pvc
            readOnly: false
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: overseerr-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-overseerr-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 5055
  selector:
    cdk8s.io/metadata.addr: lamport-overseerr-c87596e1
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    tailscale.com/funnel: "true"
  name: lamport-overseerr-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-overseerr-service
      port:
        number: 5055
  ingressClassName: tailscale
  tls:
    - hosts:
        - overseerr
---
apiVersion: onepassword.com/v1
kind: OnePasswordItem
metadata:
  name: lamport-mullvad
  namespace: lamport
spec:
  itemPath: vaults/v64ocnykdqju4ui6j6pua56xw4/items/74rqjncejp7rpgelymnmul5ssm
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-qbittorrent
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-qbittorrent-c8a4a28f
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-qbittorrent-c8a4a28f
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: VPN_SERVICE_PROVIDER
              value: airvpn
            - name: VPN_TYPE
              value: wireguard
            - name: WIREGUARD_PRIVATE_KEY
              valueFrom:
                secretKeyRef:
                  key: private-key
                  name: lamport-mullvad
            - name: WIREGUARD_PRESHARED_KEY
              valueFrom:
                secretKeyRef:
                  key: preshared-key
                  name: lamport-mullvad
            - name: WIREGUARD_ADDRESSES
              value: 10.154.174.240/32,fd7d:76ee:e68f:a993:af57:e79c:b39d:9dde/128
            - name: FIREWALL_VPN_INPUT_PORTS
              value: "16793"
          image: ghcr.io/qdm12/gluetun
          imagePullPolicy: Always
          name: gluetun
          securityContext:
            allowPrivilegeEscalation: true
            privileged: true
            readOnlyRootFilesystem: false
            runAsNonRoot: false
          volumeMounts:
            - mountPath: /gluetun
              name: pvc-qbittorrent-gluetun-pvc
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: PUID
              value: "1000"
            - name: PGID
              value: "1000"
          image: lscr.io/linuxserver/qbittorrent
          imagePullPolicy: Always
          name: qbittorrent
          ports:
            - containerPort: 8080
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsGroup: 0
            runAsNonRoot: false
            runAsUser: 0
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 8080
          volumeMounts:
            - mountPath: /config
              name: pvc-qbittorrent-pvc
            - mountPath: /downloads
              name: qbittorrent-bind-mount
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-qbittorrent-gluetun-pvc
          persistentVolumeClaim:
            claimName: qbittorrent-gluetun-pvc
            readOnly: false
        - name: pvc-qbittorrent-pvc
          persistentVolumeClaim:
            claimName: qbittorrent-pvc
            readOnly: false
        - hostPath:
            path: /mnt/storage/downloads/torrents
            type: ""
          name: qbittorrent-bind-mount
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: qbittorrent-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: qbittorrent-gluetun-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: Service
metadata:
  annotations:
    metallb.universe.tf/allow-shared-ip: gluetun
  name: lamport-qbittorrent-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 8080
  selector:
    cdk8s.io/metadata.addr: lamport-qbittorrent-c8a4a28f
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lamport-qbittorrent-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-qbittorrent-service
      port:
        number: 8080
  ingressClassName: tailscale
  tls:
    - hosts:
        - qbittorrent
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-sonarr
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-sonarr-c829f3bd
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-sonarr-c829f3bd
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: PUID
              value: "1000"
            - name: PGID
              value: "1000"
          image: lscr.io/linuxserver/sonarr
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 8989
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsGroup: 0
            runAsNonRoot: false
            runAsUser: 0
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 8989
          volumeMounts:
            - mountPath: /config
              name: pvc-sonarr-pvc
            - mountPath: /downloads
              name: sonarr-torrents-bind-mount
            - mountPath: /tv
              name: sonarr-tv-bind-mount
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-sonarr-pvc
          persistentVolumeClaim:
            claimName: sonarr-pvc
            readOnly: false
        - hostPath:
            path: /mnt/storage/downloads/torrents
            type: ""
          name: sonarr-torrents-bind-mount
        - hostPath:
            path: /mnt/storage/media/tv
            type: ""
          name: sonarr-tv-bind-mount
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sonarr-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-sonarr-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 8989
  selector:
    cdk8s.io/metadata.addr: lamport-sonarr-c829f3bd
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lamport-sonarr-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-sonarr-service
      port:
        number: 8989
  ingressClassName: tailscale
  tls:
    - hosts:
        - sonarr
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-syncthing
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-syncthing-c8119c20
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-syncthing-c8119c20
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: PUID
              value: "1000"
            - name: PGID
              value: "1000"
          image: lscr.io/linuxserver/syncthing
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 8384
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsGroup: 0
            runAsNonRoot: false
            runAsUser: 0
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 8384
          volumeMounts:
            - mountPath: /config
              name: pvc-syncthing-config
            - mountPath: /sync
              name: pvc-syncthing-data
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-syncthing-config
          persistentVolumeClaim:
            claimName: syncthing-config
            readOnly: false
        - name: pvc-syncthing-data
          persistentVolumeClaim:
            claimName: syncthing-data
            readOnly: false
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: syncthing-config
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: syncthing-data
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-syncthing-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 8384
  selector:
    cdk8s.io/metadata.addr: lamport-syncthing-c8119c20
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lamport-syncthing-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-syncthing-service
      port:
        number: 8384
  ingressClassName: tailscale
  tls:
    - hosts:
        - syncthing
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-golink
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-golink-c8950952
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-golink-c8950952
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: TS_AUTH_KEY
              valueFrom:
                secretKeyRef:
                  key: credential
                  name: tailscale-auth-key
          image: ghcr.io/tailscale/golink:main
          imagePullPolicy: Always
          name: main
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: true
            runAsGroup: 65532
            runAsNonRoot: true
            runAsUser: 65532
          volumeMounts:
            - mountPath: /home/nonroot
              name: pvc-golink-pvc
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroup: 65532
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-golink-pvc
          persistentVolumeClaim:
            claimName: golink-pvc
            readOnly: false
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: golink-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: onepassword.com/v1
kind: OnePasswordItem
metadata:
  name: tailscale-auth-key
  namespace: lamport
spec:
  itemPath: vaults/v64ocnykdqju4ui6j6pua56xw4/items/t5scpnlhnxvu25dneg6jdd7c7q
---
apiVersion: onepassword.com/v1
kind: OnePasswordItem
metadata:
  name: tmdb-api-key
  namespace: lamport
spec:
  itemPath: vaults/v64ocnykdqju4ui6j6pua56xw4/items/z5a3jfyku5hvfxjzmvzm4ma3b4
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-bitmagnet-redis-deployment
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-bitmagnet-redis-deployment-c8a1bca7
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-bitmagnet-redis-deployment-c8a1bca7
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
          image: redis
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 6379
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: true
            runAsGroup: 999
            runAsNonRoot: true
            runAsUser: 999
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 6379
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-bitmagnet-redis-deployment-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 6379
      targetPort: 6379
  selector:
    cdk8s.io/metadata.addr: lamport-bitmagnet-redis-deployment-c8a1bca7
  type: ClusterIP
---
apiVersion: onepassword.com/v1
kind: OnePasswordItem
metadata:
  name: bitmagnet-postgres-onepassword
  namespace: lamport
spec:
  itemPath: vaults/v64ocnykdqju4ui6j6pua56xw4/items/3fznikxjqt4szpz3ngdv462m6m
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-bitmagnet-postgres-deployment
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-bitmagnet-postgres-deployment-c8cacff2
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-bitmagnet-postgres-deployment-c8cacff2
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: password
                  name: bitmagnet-postgres-onepassword
            - name: PGDATA
              value: /var/lib/postgresql/data/pgdata
            - name: POSTGRES_DB
              value: bitmagnet
          image: postgres
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 5432
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsGroup: 1000
            runAsNonRoot: true
            runAsUser: 1000
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 5432
          volumeMounts:
            - mountPath: /var/lib/postgresql/data
              name: pvc-bitmagnet-postgres-volume
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroup: 1000
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-bitmagnet-postgres-volume
          persistentVolumeClaim:
            claimName: bitmagnet-postgres-volume
            readOnly: false
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-bitmagnet-postgres-deployment-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 5432
      targetPort: 5432
  selector:
    cdk8s.io/metadata.addr: lamport-bitmagnet-postgres-deployment-c8cacff2
  type: ClusterIP
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: bitmagnet-postgres-volume
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-bitmagnet
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-bitmagnet-c8718e1d
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-bitmagnet-c8718e1d
    spec:
      automountServiceAccountToken: false
      containers:
        - command:
            - bitmagnet
            - worker
            - run
            - --keys=http_server
            - --keys=queue_server
            - --keys=dht_crawler
          env:
            - name: TZ
              value: America/Los_Angeles
            - name: POSTGRES_HOST
              value: lamport-bitmagnet-postgres-deployment-service
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: password
                  name: bitmagnet-postgres-onepassword
            - name: REDIS_ADDR
              value: lamport-bitmagnet-redis-deployment-service:6379
            - name: TMDB_API_KEY
              valueFrom:
                secretKeyRef:
                  key: api-key
                  name: tmdb-api-key
          image: ghcr.io/bitmagnet-io/bitmagnet:latest
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 3333
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: true
            runAsGroup: 0
            runAsNonRoot: false
            runAsUser: 0
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 3333
          volumeMounts:
            - mountPath: /app
              name: pvc-bitmagnet-pvc
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-bitmagnet-pvc
          persistentVolumeClaim:
            claimName: bitmagnet-pvc
            readOnly: false
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: bitmagnet-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-bitmagnet-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 3333
  selector:
    cdk8s.io/metadata.addr: lamport-bitmagnet-c8718e1d
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lamport-bitmagnet-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-bitmagnet-service
      port:
        number: 3333
  ingressClassName: tailscale
  tls:
    - hosts:
        - bitmagnet
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-prowlarr
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-prowlarr-c8f63e06
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-prowlarr-c8f63e06
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: PUID
              value: "1000"
            - name: PGID
              value: "1000"
          image: lscr.io/linuxserver/prowlarr
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 9696
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsGroup: 0
            runAsNonRoot: false
            runAsUser: 0
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 9696
          volumeMounts:
            - mountPath: /config
              name: pvc-prowlarr-pvc
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-prowlarr-pvc
          persistentVolumeClaim:
            claimName: prowlarr-pvc
            readOnly: false
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: prowlarr-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-prowlarr-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 9696
  selector:
    cdk8s.io/metadata.addr: lamport-prowlarr-c8f63e06
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lamport-prowlarr-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-prowlarr-service
      port:
        number: 9696
  ingressClassName: tailscale
  tls:
    - hosts:
        - prowlarr
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-palworld
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-palworld-c897ee52
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-palworld-c897ee52
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: PORT
              value: "8211"
            - name: PLAYERS
              value: "16"
            - name: SERVER_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: password
                  name: lamport-palworld-item
            - name: MULTITHREADING
              value: "true"
            - name: RCON_ENABLED
              value: "true"
            - name: RCON_PORT
              value: "27015"
            - name: ADMIN_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: rcon-password
                  name: lamport-palworld-item
            - name: COMMUNITY
              value: "false"
            - name: SERVER_NAME
              value: glitter
            - name: SERVER_DESCRIPTION
              value: whats up guys
            - name: DEATH_PENALTY
              value: ItemAndEquipment
            - name: BACKUP_ENABLED
              value: "false"
            - name: PAL_EGG_DEFAULT_HATCHING_TIME
              value: "1.000000"
            - name: ENABLE_INVADER_ENEMY
              value: "False"
            - name: PAL_STOMACH_DECREASE_RATE
              value: "-1.000000"
            - name: UPDATE_ON_BOOT
              value: "true"
            - name: BUILD_OBJECT_DETERIORATION_DAMAGE_RATE
              value: "0"
          image: thijsvanloef/palworld-server-docker
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 8211
              protocol: UDP
            - containerPort: 27015
              protocol: UDP
          resources:
            limits:
              memory: 20480Mi
          securityContext:
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: false
            runAsNonRoot: false
          volumeMounts:
            - mountPath: /palworld
              name: pvc-palworld-pvc
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-palworld-pvc
          persistentVolumeClaim:
            claimName: palworld-pvc
            readOnly: false
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: palworld-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: onepassword.com/v1
kind: OnePasswordItem
metadata:
  name: lamport-palworld-item
  namespace: lamport
spec:
  itemPath: vaults/v64ocnykdqju4ui6j6pua56xw4/items/yrlyezq2axgfkdfchtl7n7o6b4
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-palworld-game-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - nodePort: 30000
      port: 8211
      protocol: UDP
  selector:
    cdk8s.io/metadata.addr: lamport-palworld-c897ee52
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-palworld-query-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - nodePort: 30001
      port: 27015
      protocol: UDP
  selector:
    cdk8s.io/metadata.addr: lamport-palworld-c897ee52
  type: NodePort
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: lamport-earthly
  namespace: lamport
spec:
  minReadySeconds: 0
  progressDeadlineSeconds: 600
  replicas: 1
  selector:
    matchLabels:
      cdk8s.io/metadata.addr: lamport-earthly-c8d12215
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        cdk8s.io/metadata.addr: lamport-earthly-c8d12215
    spec:
      automountServiceAccountToken: false
      containers:
        - env:
            - name: TZ
              value: America/Los_Angeles
            - name: PUID
              value: "1000"
            - name: PGID
              value: "1000"
            - name: EARTHLY_ORG
              value: sjerred
            - name: EARTHLY_TOKEN
              valueFrom:
                secretKeyRef:
                  key: credential
                  name: earthly-onepassword
            - name: SATELLITE_NAME
              value: lamport
            - name: SATELLITE_HOST
              value: earthly.tailnet-1a49.ts.net
            - name: CACHE_SIZE_PCT
              value: "10"
            - name: BUILDKIT_MAX_PARALLELISM
              value: "24"
          image: earthly/earthly
          imagePullPolicy: Always
          name: main
          ports:
            - containerPort: 8372
          securityContext:
            allowPrivilegeEscalation: true
            privileged: true
            readOnlyRootFilesystem: false
            runAsGroup: 0
            runAsNonRoot: false
            runAsUser: 0
          startupProbe:
            failureThreshold: 3
            tcpSocket:
              port: 8372
          volumeMounts:
            - mountPath: /tmp/earthly
              name: pvc-earthly-pvc
      dnsPolicy: ClusterFirst
      hostNetwork: false
      restartPolicy: Always
      securityContext:
        fsGroupChangePolicy: Always
        runAsNonRoot: true
      setHostnameAsFQDN: false
      terminationGracePeriodSeconds: 30
      volumes:
        - name: pvc-earthly-pvc
          persistentVolumeClaim:
            claimName: earthly-pvc
            readOnly: false
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: earthly-pvc
  namespace: lamport
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  volumeMode: Filesystem
---
apiVersion: onepassword.com/v1
kind: OnePasswordItem
metadata:
  name: earthly-onepassword
  namespace: lamport
spec:
  itemPath: vaults/v64ocnykdqju4ui6j6pua56xw4/items/sbjrtou6h3f5w2uhj4uluywsre
---
apiVersion: v1
kind: Service
metadata:
  name: lamport-earthly-service
  namespace: lamport
spec:
  externalIPs: []
  ports:
    - port: 8372
  selector:
    cdk8s.io/metadata.addr: lamport-earthly-c8d12215
  type: ClusterIP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: lamport-earthly-tailscale-ingress-ingress
  namespace: lamport
spec:
  defaultBackend:
    service:
      name: lamport-earthly-service
      port:
        number: 8372
  ingressClassName: tailscale
  tls:
    - hosts:
        - earthly
